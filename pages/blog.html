<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <link rel="icon" href="../Assets/img/Logo.png" type="image/png" />
    <link rel="stylesheet" href="../Assets/style.css" />
    <title>Blog</title>
  </head>
  <body>
    <!-- ============  HEADER ========== -->
    <header class="header">
      <div class="container">
        <div class="row align-items-center justify-content-between">
          <div class="logo">
            <a href="../index.html"
              ><img src="../Assets/img/Logo.png" alt=""
            /></a>
          </div>
          <input type="checkbox" id="nav-check" />
          <label for="nav-check" class="nav-toggler">
            <span></span>
          </label>
          <nav class="nav">
            <ul>
              <li><a href="../index.html">home</a></li>
              <li><a href="./About.html">about</a></li>
              <li><a href="./Portfolio.html">portfolio</a></li>
              <li><a href="./blog.html">Blog</a></li>
              <li><a href="./contact.html">contact</a></li>
              <li>
                <button class="nav_login">
                  <a href="./login.html" id="nav_login_name">Login</a>
                </button>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </header>
    <!-- ========== MAIN ========== -->
    <section id="single-blog">
      <!-- Heading -->
      <div class="single-blog-heading">
        <h3 id="blog-title"></h3>
        <span id="blog-date"></span>
      </div>
      <!-- ====Single Blog container==== -->
      <div class="single-blog-container">
        <!-- image -->
        <div class="single-blog-img">
          <img id="blog-img" src="" alt="Blog 1" />
        </div>
        <!-- Text -->
        <div class="single-blog-text">
          <p id="blog-content"></p>
        </div>
      </div>
      <!-- ====Comments section==== -->
      <div class="comments-section">
        <h3>Comments <span id="countComments">0</span></h3>
        <div id="comments-container">
          <!-- Single Comment -->
          <div class="single-comment">
            <p><span class="username"></span></p>
          </div>
        </div>
        <!-- Add Comment -->
        <div class="add-comment">
          <form action="#" id="comment-form">
            <textarea
              placeholder="Add your comment here"
              cols="50px"
              rows="10px"
            ></textarea>
            <input type="submit" value="Submit Comment" />
          </form>
        </div>
      </div>
    </section>
    <script>
      const postId = localStorage.getItem("keyToRead");
      const token = localStorage.getItem("auth-token");

      fetch(
        `https://capstone-backend-mzjj.onrender.com/posts/${encodeURIComponent(
          postId
        )}`,
        {
          headers: {
            Authorization: `Bearer ${token}`,
            "Content-Type": "application/json",
          },
        }
      )
        .then((response) => {
          if (!response.ok) {
            throw new Error("Network response was not ok");
          }
          return response.json();
        })
        .then((data) => {
          console.log(data);
          document.querySelector("#blog-title").textContent = data.data.title;
          document.querySelector("#blog-date").textContent = formatDate(
            data.data.date
          );
          document.querySelector("#blog-img").src = data.data.imageUrl;
          document.querySelector("#blog-content").textContent =
            data.data.description;

          let comments = data.comments;
          document.querySelector("#countComments").textContent =
            comments.length;
          let commentsContainer = document.querySelector("#comments-container");

          for (let i = 0; i < comments.length; i++) {
            let singleComment = document.createElement("div");
            singleComment.classList.add("single-comment");

            let comment = comments[i];
            let username = document.createElement("p");
            username.innerHTML =
              "<span class='username'>" + comment.username + "</span>";

            singleComment.appendChild(username);
            commentsContainer.appendChild(singleComment);
          }
        })
        .catch((error) => {
          console.error("There was a problem with the fetch operation:", error);
        });
      function formatDate(dateString) {
        let date = new Date(dateString);
        return date.toLocaleDateString("en-GB", {
          day: "2-digit",
          month: "2-digit",
          year: "numeric",
        });
      }
    </script>
  </body>
</html>
